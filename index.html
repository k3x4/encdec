<!doctype html>
<html lang="el">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2-Password Encryptor (Single String, AES-GCM)</title>
    <style>
        :root {
            font-family: system-ui, Arial, sans-serif;
            color-scheme: light dark;
        }

        body {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        h1 {
            font-size: 1.2rem;
        }

        textarea,
        input[type=password] {
            width: 100%;
            box-sizing: border-box;
        }

        .row {
            display: grid;
            gap: .75rem;
            margin: 1rem 0;
        }

        .grid {
            display: grid;
            gap: .75rem;
            grid-template-columns: 1fr 1fr;
        }

        button {
            padding: .6rem 1rem;
            border-radius: .5rem;
            border: 1px solid #8884;
            cursor: pointer;
        }

        .muted {
            opacity: .85;
            font-size: .9rem;
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        }

        .ok {
            color: #0a7;
        }

        .err {
            color: #c33;
        }
    </style>
</head>

<body>
    <h1>ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î¼Îµ 2 ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ â€” ÎˆÎ½Î± Î¼ÏŒÎ½Î¿ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ string</h1>

    <div class="row">
        <label>ÎšÎµÎ¯Î¼ÎµÎ½Î¿ (Î³Î¹Î± ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·) Î® ÎšÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ string (Î³Î¹Î± Î±Ï€Î¿ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·):</label>
        <textarea id="input" rows="10"
            placeholder="Î“ÏÎ¬ÏˆÎµ ÎµÎ´Ï Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î³Î¹Î± ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· Î® ÎµÏ€Î¹ÎºÏŒÎ»Î»Î·ÏƒÎµ Ï„Î¿ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ string"></textarea>
    </div>

    <div class="grid">
        <div>
            <label>Password A</label>
            <input id="pwA" type="password" autocomplete="current-password">
        </div>
        <div>
            <label>Password B</label>
            <input id="pwB" type="password" autocomplete="current-password">
        </div>
    </div>

    <div class="grid">
        <button id="btnEnc">ğŸ”’ ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·</button>
        <button id="btnDec">ğŸ”“ Î‘Ï€Î¿ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·</button>
    </div>

    <div class="row">
        <label>Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± (single string):</label>
        <textarea id="output" class="mono" rows="10" readonly
            placeholder="Î•Î´Ï Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ Ï„Î¿ Î­Î½Î± ÎºÎ±Î¹ Î¼Î¿Î½Î±Î´Î¹ÎºÏŒ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ string Î® Ï„Î¿ Î±Ï€Î»ÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·"></textarea>
        <div class="grid">
            <button id="btnCopy">ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®</button>
            <button id="btnClear">ğŸ§¹ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
        </div>
        <div id="status" class="muted"></div>
    </div>

    <script>
        (function () {
            const enc = new TextEncoder();
            const dec = new TextDecoder();

            const $ = s => document.querySelector(s);
            const input = $('#input'), output = $('#output');
            const pwA = $('#pwA'), pwB = $('#pwB'), status = $('#status');

            // Base64url helpers (Ï‡Ï‰ÏÎ¯Ï‚ padding)
            const b64u = {
                to(u8) {
                    let s = '';
                    for (let i = 0; i < u8.length; i++) s += String.fromCharCode(u8[i]);
                    return btoa(s).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
                },
                from(s) {
                    s = s.replace(/-/g, '+').replace(/_/g, '/');
                    // ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ padding
                    const pad = s.length % 4;
                    if (pad) s += '='.repeat(4 - pad);
                    const bin = atob(s);
                    const u8 = new Uint8Array(bin.length);
                    for (let i = 0; i < bin.length; i++) u8[i] = bin.charCodeAt(i);
                    return u8;
                }
            };

            function ui(msg, ok = true) { status.textContent = msg; status.className = 'muted ' + (ok ? 'ok' : 'err'); }
            function combine(a, b) { return enc.encode(String(a ?? '') + '\u0000' + String(b ?? '')); }

            async function deriveKey(passBytes, salt, iterations) {
                const baseKey = await crypto.subtle.importKey('raw', passBytes, { name: 'PBKDF2' }, false, ['deriveKey']);
                return crypto.subtle.deriveKey(
                    { name: 'PBKDF2', hash: 'SHA-256', salt, iterations },
                    baseKey,
                    { name: 'AES-GCM', length: 256 },
                    false,
                    ['encrypt', 'decrypt']
                );
            }

            // Î Î±ÎºÎµÏ„Î¬ÏÎ¹ÏƒÎ¼Î± ÏƒÎµ Î­Î½Î± binary blob:
            // [ 1B version | 4B iterations (big-endian) | 16B salt | 12B iv | N bytes ciphertext+tag ]
            function pack(version, iterations, salt, iv, ct) {
                const header = new Uint8Array(1 + 4 + 16 + 12);
                let o = 0;
                header[o++] = version & 0xFF;
                header[o++] = (iterations >>> 24) & 0xFF;
                header[o++] = (iterations >>> 16) & 0xFF;
                header[o++] = (iterations >>> 8) & 0xFF;
                header[o++] = iterations & 0xFF;
                header.set(salt, o); o += 16;
                header.set(iv, o); o += 12;
                const out = new Uint8Array(header.length + ct.length);
                out.set(header, 0);
                out.set(ct, header.length);
                return out;
            }

            function unpack(u8) {
                if (u8.length < 1 + 4 + 16 + 12 + 1) throw new Error('ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î¼Î®ÎºÎ¿Ï‚.');
                let o = 0;
                const version = u8[o++];
                const iterations = (u8[o++] << 24) | (u8[o++] << 16) | (u8[o++] << 8) | (u8[o++]);
                const salt = u8.slice(o, o + 16); o += 16;
                const iv = u8.slice(o, o + 12); o += 12;
                const ct = u8.slice(o);
                return { version, iterations, salt, iv, ct };
            }

            const DEFAULT_ITERS = 400000; // Î±ÏÎ¾Î·ÏƒÎ­ Ï„Î¿ Î±Î½ Î¸ÎµÏ‚ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ ÎºÏŒÏƒÏ„Î¿Ï‚

            $('#btnEnc').addEventListener('click', async () => {
                try {
                    if (!input.value) return ui('Î”ÏÏƒÎµ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î³Î¹Î± ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·.', false);
                    if (!pwA.value || !pwB.value) return ui('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚ Î´ÏÎ¿ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚.', false);

                    const salt = crypto.getRandomValues(new Uint8Array(16));
                    const iv = crypto.getRandomValues(new Uint8Array(12));
                    const key = await deriveKey(combine(pwA.value, pwB.value), salt, DEFAULT_ITERS);

                    const pt = enc.encode(input.value);
                    const ct = new Uint8Array(await crypto.subtle.encrypt({ name: 'AES-GCM', iv, tagLength: 128 }, key, pt));

                    const blob = pack(1, DEFAULT_ITERS, salt, iv, ct);
                    output.value = b64u.to(blob);
                    ui('ÎˆÎ³Î¹Î½Îµ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·.');
                } catch (e) {
                    console.error(e);
                    ui('Î£Ï†Î¬Î»Î¼Î± ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·Ï‚: ' + e.message, false);
                }
            });

            $('#btnDec').addEventListener('click', async () => {
                try {
                    if (!input.value) return ui('Î•Ï€Î¹ÎºÏŒÎ»Î»Î·ÏƒÎµ Ï„Î¿ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ string ÏƒÏ„Î¿ ÎµÏ€Î¬Î½Ï‰ Ï€ÎµÎ´Î¯Î¿.', false);
                    if (!pwA.value || !pwB.value) return ui('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚ Î´ÏÎ¿ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚.', false);

                    const blob = b64u.from(input.value.trim());
                    const { version, iterations, salt, iv, ct } = unpack(blob);
                    if (version !== 1) throw new Error('ÎœÎ· Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î· Î­ÎºÎ´Î¿ÏƒÎ·.');

                    const key = await deriveKey(combine(pwA.value, pwB.value), salt, iterations);
                    const pt = await crypto.subtle.decrypt({ name: 'AES-GCM', iv, tagLength: 128 }, key, ct);
                    output.value = dec.decode(pt);
                    ui('ÎˆÎ³Î¹Î½Îµ Î±Ï€Î¿ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·.');
                } catch (e) {
                    console.error(e);
                    ui('Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Î±Ï€Î¿ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·Ï‚ (Î»Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Î¯ Î® ÎºÎ±Ï„ÎµÏƒÏ„ÏÎ±Î¼Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±).', false);
                }
            });

            $('#btnCopy').addEventListener('click', async () => {
                try { await navigator.clipboard.writeText(output.value || ''); ui('Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ.'); }
                catch { ui('Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®Ï‚.', false); }
            });

            $('#btnClear').addEventListener('click', () => { input.value = ''; output.value = ''; ui('ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Î·ÎºÎ±Î½ Ï„Î± Ï€ÎµÎ´Î¯Î±.'); });
        })();
    </script>
</body>

</html>